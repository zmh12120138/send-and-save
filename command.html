<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>抄表管理界面</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./socket.io/socket.io.js"></script>
    <script>
        var command=io.connect("localhost:1338");
        function meterReading() {
            var meterid = document.getElementById('meterid').value;
            var code = document.getElementById('code').value;
            if (meterid.length != 8) {
                document.getElementById('errMsg').innerHTML = "<p>表号长度输入错误！</p>"
                return false;
            }
            if (code == '') {
                document.getElementById('errMsg').innerHTML = "<p>任务编号不能为空！</p>"
                return false;
            }
            var parse1 = meterid.slice(0, 2);
            var parse2 = meterid.slice(2, 4);
            var parse3 = meterid.slice(4, 6);
            var parse4 = meterid.slice(6, 8);
            var commandSend = 'FE FE FE FE ' + parse4 + ' ' + parse3 + ' ' + parse2 + ' ' + parse1 + ' ' + '00 11 11 01 03 1F 90 12 82 16';
            var data = {};
            data.commandSend = commandSend;
            data.code = code;
            data.meterid = meterid;
            document.write('抄表，命令为' + commandSend);
            command.emit('meterReading', data);
            alert('命令已发送！');
        }
        function setInfo(){
             var time = document.getElementById('time').value;
            var frequency = document.getElementById('frequency').value;
            if (time == '') {
                document.getElementById('errMsg').innerHTML = "<p>时间不能为空！</p>"
                return false;
            }
            if (frequency == '') {
                document.getElementById('errMsg').innerHTML = "<p>次数不能为空！</p>"
                return false;
            }
            alert('设置成功!时间间隔:'+time+'秒，次数'+frequency+'次');
            var setinfo={};
            setinfo.time=time;
            setinfo.frequency=frequency;
            command.emit('setInfo',setinfo);

        }
    </script>
</head>

<body>
<div id="body" class="container center-block" style="padding: 50px 300px 300px 50px" >
    <div class="jumbotron center-block">
        <h2>抄表管理</h2>
        <form>
            <div class="input-group">
                <span class="input-group-addon">表&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;号：</span>
                <input type="number" id="meterid" class="form-control"/>
            </div>
            <br>
            <br>
            <div class="input-group">
                <span class="input-group-addon">任务编号：</span>
                <input type="number" id="code" class="form-control"/>
            </div>
            <br>
            <br>
            <button class="btn btn-info center-block" onclick="meterReading()">抄表</button>
            <br>
            <div id="errMsg" class="center-block" style="font-weight: bold"></div>
            <br>
            <br>
            <div class="input-group">
                <span class="input-group-addon">间隔(秒)：</span>
                <input type="number" id="time" class="form-control"/>
            </div>
            <br>
            <br>
            <div class="input-group">
                <span class="input-group-addon">次&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数：</span>
                <input type="number" id="frequency" class="form-control"/>
            </div>
            <br>
            <br>
            <button id="setting" class="btn btn-danger center-block" onclick="setInfo()">设置</button>
            <br>
            <br>
        </form>
    </div>

</div>
</body>
</html>